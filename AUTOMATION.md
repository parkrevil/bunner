# AUTOMATION

## 역할

- 이 문서는 자동화(스크립트/에이전트/CI)가 수행할 수 있는 작업 범위, 권한, 금지 영역, 예외 절차를 정의한다.
- 자동화의 “묵시적 확장”을 차단하고, 변경의 감사 가능성과 결정성을 보장한다.

## 적용 범위

- CI 파이프라인, 레포 내 스크립트, 코드 생성기, 에이전트 기반 자동 수정/자동 PR, 도구 기반 리팩토링 등 자동화 전반

## 정본/우선순위

- 최상위 정본은 [SPEC.md](SPEC.md)다.
- 이 문서는 “자동 실행/도구 실행/에이전트 실행”의 집행 규칙을 정의한다.
- 문서 간 충돌이 발생하면 [SPEC.md](SPEC.md) 및 각 SSOT 문서(예: [ARCHITECTURE.md](ARCHITECTURE.md), [STRUCTURE.md](STRUCTURE.md), [DEPENDENCIES.md](DEPENDENCIES.md), [TOOLING.md](TOOLING.md))가 우선한다.

## 정의 (Definitions)

- **자동화(Automation)**: 사람의 직접 편집 없이 실행되며 파일/구성/메타데이터에 영향을 줄 수 있는 모든 실행 단위.
- **에이전트(Agent)**: 자연어 지시를 기반으로 변경을 제안/생성하는 자동화.
- **외부 시스템(External System)**: 레포/CI 런타임 밖에 존재하며 네트워크를 통해 접근하는 모든 시스템(예: SaaS, API, DB, 메시지 브로커, 클라우드 리소스).
- **요청 범위(Request Scope)**: 자동화가 수행해야 하는 변경 범위를 의미하며, 최소한 다음 중 하나 이상으로 명시되어야 한다(MUST):
  - 대상 디렉터리/패키지 목록
  - 변경 유형(예: 버그 수정, 타입 보강, 리팩토링 금지 등)
  - 제외 대상(명시적 non-goals)
- **노이즈 PR**: 기능적 의미가 없는 대규모 포맷 변경, 정렬 변경, 혹은 요청 범위와 무관한 코드 이동만 포함된 PR.
- **SSOT**: 레포의 “규칙/정책/결정성”을 규정하는 문서 및 파일.
  - 최소 포함: `SPEC.md`, `ARCHITECTURE.md`, `STRUCTURE.md`, `DEPENDENCIES.md`, `TOOLING.md`, 본 문서(`AUTOMATION`).
  - 프로젝트에 따라 추가: 릴리즈 정책, 보안 정책, 빌드/배포 정책 문서.

## 기본 원칙

- 자동화는 기본 브랜치(또는 보호 브랜치)에 **직접 커밋/푸시할 수 없다**. 변경은 PR(또는 동등한 리뷰 워크플로우)로만 제안한다.
- 자동화는 결정성을 해치지 않아야 한다. (툴체인/의존성/출력물은 재현 가능해야 한다.)
- 자동화는 “요청 범위”를 벗어나는 변경을 해서는 안 된다. 범위가 불명확한 경우 자동화는 실행을 계속해서는 안 된다(MUST NOT). 이 경우 자동화는 실행을 중단하고, 범위 명세 요청만 생성해야 한다.
- 자동화는 최소 권한 원칙(Least Privilege)을 따른다.
- 본 문서에서 명시적으로 허용되지 않은 행위는 허용된 것으로 간주되지 않는다.
- 데드 코드/파일 제거 작업은 [DEAD_CODE_POLICY.md](DEAD_CODE_POLICY.md)를 따른다.

## 권한 모델 (Permission Levels)

자동화는 아래 권한 중 하나로만 실행된다. 기본값은 Read/Propose이다.

1. **Read**: 조회/검색/분석만 가능(파일 수정 금지)
2. **Propose**: 변경 제안 가능(브랜치 생성 및 PR 생성 가능), 단 보호된 영역 수정은 금지
3. **Modify**: 제한된 영역 내에서만 수정 가능(명시된 디렉터리/파일 패턴)
   Modify 권한은 특정 워크플로우 또는 단일 실행(run)에 한해 부여될 수 있으며, 상시 권한으로 간주되어서는 안 된다(MUST NOT).
4. **Release**: 버전/태그/배포 관련 작업(기본 금지, 별도 승인 워크플로우 필요)
   Release 권한은 사람에 의한 명시적 트리거 없이는 실행될 수 없다(MUST NOT).

> 어떤 자동화가 어떤 권한으로 실행되는지는 CI 설정/워크플로우에서 명시되어야 한다.

## 허용 범위

### 관측 전용(Read)

- 파일 목록화, 검색, 정적 분석, 의존성/라이선스/취약점 스캔 결과 리포트 작성
- 테스트/린트/타입체크 실행 및 결과 보고
- 변경 영향도(패키지 경계, API 변경, 퍼블릭 표면) 분석 리포트

### 변경 제안(Propose)

- 사용자가 명시한 작업 단위에 한해 변경을 제안(PR 생성)할 수 있다.
- PR에는 반드시 다음을 포함한다:
  - 변경 목적/범위(파일/패키지 단위)
  - 변경 근거(요청 텍스트/이슈 링크/실패한 CI 로그 요약)
  - 실행한 검사 목록(테스트/린트/타입체크)과 결과
  - 롤백 방법(가능한 경우)

### 제한 변경(Modify)

- Modify 권한이 허용된 워크플로우는 “허용 디렉터리/파일 패턴”을 별도로 선언해야 한다.
- Modify로도 SSOT 및 고위험 영역은 수정할 수 없다(아래 금지/보호 영역 참고).

## 보호/금지 영역 (Default Deny)

자동화는 아래 항목을 **기본 금지**한다. 예외는 “예외 절차”를 따른다.

### SSOT 변경 금지

- SSOT 문서 및 정책 파일은 자동화가 기본적으로 직접 수정할 수 없다(Default Deny).
- SSOT 변경이 필요하면 예외 절차를 통해 명시적 승인을 받아야 한다.

### 공급망/보안 고위험 변경 금지

- 새 의존성 추가, 의존성 대규모 업그레이드/다운그레이드, lockfile/툴체인 변경
- 빌드/배포 파이프라인 변경(예: `.github/workflows/**`, 배포 스크립트)
- 시크릿/키/토큰/인증 정보 취급 및 로그 출력
- 외부 네트워크로의 임의 업로드/전송(기본 차단; 필요한 경우 허용 목록 기반)
  - 특히 Read/Propose 권한의 자동화는 외부 시스템에 대한 상태 변경을 유발하는 요청을 수행해서는 안 된다(MUST NOT).
  - 외부 네트워크 전송 허용 목록의 SSOT는 [GOVERNANCE.md](GOVERNANCE.md) 또는 CI 설정이다.

### 아키텍처 경계 위반 금지

- 패키지 경계 침범(deep import) 유도
- 런타임 스캔/리플렉션/동적 의존성 도입
- 요청 범위 밖 대규모 리팩토링/포맷 변경(노이즈 PR 생성 금지)

### 생성물(Generated Output) 포함 금지

- 자동화는 생성물(예: `.bunner/**`, `dist/**`)을 기본적으로 PR에 포함하지 않는다(Default Deny).
- 생성물 포함이 필요하면 예외 절차를 통해 명시적 승인을 받아야 한다.

## 예외 절차 (Escalation)

- 금지/보호 영역 변경이 필요하면 자동화는 즉시 중단하고,
  - 변경 필요 사유
  - 대안(가능한 경우)
  - 최소 변경안
  - 예상 리스크와 검증 플랜
    을 포함한 “예외 요청”을 생성한다.
- 예외 승인 없이는 실행을 재개할 수 없다.

예외 승인/절차의 SSOT는 [GOVERNANCE.md](GOVERNANCE.md)다.

## 결정성 및 재현성 (Determinism)

- 자동화는 툴체인 버전, 실행 커맨드, 환경 가정(예: OS/런타임)을 PR 또는 리포트에 남겨야 한다.
- 자동 생성 파일은 입력이 같으면 출력이 같아야 하며, 포맷팅/정렬 규칙은 고정되어야 한다.
- 캐시 의존으로 결과가 달라질 수 있는 단계는 반드시 재현 가능한 모드로 실행해야 한다(가능한 범위에서).

## 감사 가능성 (Auditability)

- 자동화가 만든 모든 변경(PR/커밋)에는 다음 메타데이터를 남긴다:
  - 실행 주체(워크플로우/에이전트 이름)
  - 실행 트리거(수동/스케줄/PR 코멘트 등)
  - 입력(요청/이슈/명령)
  - 산출물(변경 파일 목록, 테스트 결과)
- 자동화가 정책에 의해 중단될 경우, 중단 사유와 판단 근거를 실행 로그 또는 PR 코멘트로 남겨야 한다(SHOULD).
- 자동화는 불필요한 로그에 민감정보가 포함되지 않도록 해야 한다.

## 실행 체크리스트

- [ ] SSOT/보호 영역을 수정하려는가? → 즉시 중단, 예외 요청으로 전환
- [ ] 요청 범위 밖 변경이 발생했는가? → 즉시 중단, 범위 명세 요청
- [ ] 테스트/린트/타입체크를 실행했는가? → 결과를 PR에 첨부
- [ ] 아키텍처 경계에 영향이 있는가? → 아키텍처 체크(예: `architecture:check`) 결과를 PR에 첨부
- [ ] 변경이 결정적/재현 가능한가? → 툴체인/커맨드/환경 가정을 기록
