---
description: 단일 Run Plan 템플릿 (에이전트 실행 입력)
---

# Run Plan

> 이 문서는 “사람용 계획서/아카이브”가 아니라, 에이전트가 작업을 시작하기 전에 반드시 채워야 하는 **실행 입력(Template)** 이다.
>
> 기본 원칙:
>
> - 추측 금지: 불확실하면 중단하고 확인을 요청한다.
> - 범위 밖 변경 금지: 필요하면 사전 승인을 요청한다.
> - Public API/Contract 무단 변경 금지.
> - AOT 결정성/경계 규칙 위반 금지.
> - 플레이스홀더/부분 구현 금지.

> 중단 강제 조건:
>
> - 입력 요구사항이 SSOT 문서 내 명시적 키워드/섹션으로 매핑되지 않는 경우
> - Public Facade 변경 여부가 명확히 판정되지 않는 경우
> - 변경 대상 파일이 Scope에 명시되지 않은 경우
>   → 즉시 중단 후 사용자 확인 요청
>
> 게이트(SSOT):
>
> - 최상위 불변조건: `docs/specs/spec.md`
> - 구조/경계 판정: `ARCHITECTURE.md`
> - 파일 배치: `STRUCTURE.md`
> - 코딩 규칙: `STYLEGUIDE.md`
> - 승인/중단/정책: `docs/governance/*` 및 `.agent/workflow.md`

## 작성 가이드(MUST)

- 저장 위치: `docs/plans/<yymmdd>_<seq>_<plan-name>.md`
  - 예: `docs/plans/260105_01_di-manifest.md`
  - `yymmdd`: 6자리 날짜
  - `seq`: 기본 2자리(01~99), 100부터 3자리 허용
  - `plan-name`: 영어 `kebab-case`만
- 상태(status) 갱신: `.agent/workflow.md`의 상태 머신을 따른다
  - `draft` → `accepted` → `in-progress` → `implemented`
  - 취소 상태: `canceled`
    - 작업 중단 또는 완료 후 롤백으로 무효화
  - 사용자 승인 증거는 키워드 `ㅇㅇ`로만 인정한다

### 불변/참조 규칙 (MUST)

- Plan은 새 작업 시작 시에만 생성한다.
- Plan의 변경(순서/범위/변경 파일 목록 포함)이 필요해지면, 반드시 사용자 승인(키워드 `ㅇㅇ`)을 먼저 받아야 한다.
- Plan 수정은 `in-progress`에서만 허용한다.
  - 허용 범위: Plan 본문을 덮어쓰지 않고, "Plan Changes" 섹션에 append-only로 변경 사항을 추가한다.
  - 사용자가 승인하지 않으면 즉시 중단한다.
- 아래 status의 Plan은 본문이 불변이다.
  - `accepted`
  - `implemented`
  - `canceled`

- 사용자의 명시적 지시(참조 대상 경로 지정) 없이는, 현재 작업 Plan이 아닌 Plan(과거 Plan)을 조회/참조/범위에 포함하지 않는다.

---

## 0) 시발점(원문)

- 원문:
  - "<여기에 사용자가 처음 한 말 그대로 붙여넣기>"

- 에이전트 이해(원문을 바탕으로 한, 구체적/검증 가능한 해석):
  - <무엇을, 왜, 어떤 결과로 만들라는지>
  - <성공 조건(사용자 관점)>
  - <제약/금지(사용자 지정 + SSOT 기반)>

- **SSOT 충돌 판정**: 원문 요구사항 중 docs/specs/ 및 ARCHITECTURE 불변조건과 잠재적으로 충돌하는 지점이 있는가?
  - 있다면: <충돌 지점> / <조정 방안(범위/대안/승인 필요 여부 포함)>
  - 충돌이 있는 경우:
    - 상태를 `draft`로 유지
    - 구현 단계(5~7) 작성 금지
    - 사용자 승인 없이는 대안 실행 금지

---

## 1) 기대효과(제한 없음, 짧게)

- <기대효과 1>
- <기대효과 2>
- <기대효과 N>

---

## 2) 범위(Scope) / 비범위(Non-Goals)

### Scope (반드시 “왜 이 파일/디렉터리를 건드리는지” 포함)

- 변경 대상(디렉터리/파일)과 이유:
  - <path>: <왜 필요한지>
  - <path>: <왜 필요한지>

- 변경 유형:
  - [ ] 생성
  - [ ] 수정
  - [ ] 삭제
  - [ ] 이동/병합

- Blast Radius(영향 범위 선언):
  - 영향을 받을 수 있는 패키지/모듈(나열): <...>
  - 의존성 전파 분석(Upstream/Downstream): <변경이 어떤 방향으로 영향을 전파하는지>
    - 예: `common` 변경 → `core`/`adapter`까지 재검증 필요 여부
    - 영향받는 패키지는 Verify 단계에서 재검증 대상에 자동 포함
  - Public Facade(`packages/*/index.ts`) 변경 여부: 없음 | 있음(승인 필요)
  - 패키지 간 의존 변경 여부: 없음 | 있음(ARCHITECTURE 매트릭스 판정 필요)

### Non-Goals

- <이번 작업에서 하지 않는 것>

---

## 3) SSOT 준수 체크(작업 전 판정)

> 아래 항목은 “체크했다”가 아니라, **판정 근거(문서 섹션/키워드)** 를 간단히 적는다.

- SPEC (불변조건/금지선)
  - [ ] `reflect-metadata`/런타임 리플렉션 도입 없음 (근거: <SPEC 섹션/키워드>)
  - [ ] 비결정적 산출물(시간/랜덤/환경 의존) 도입 없음 (근거: <SPEC 섹션/키워드>)
  - [ ] 런타임 동적 import/스캔/등록 도입 없음 (근거: <SPEC 섹션/키워드>)

- ARCHITECTURE (경계/Facade)
  - [ ] cross-package deep import 없음 (`@bunner/*/src/**` 금지) (근거: <ARCHITECTURE 섹션/키워드>)
  - [ ] 패키지 간 참조는 Public Facade로만 (근거: <ARCHITECTURE 섹션/키워드>)
  - [ ] 순환 의존 도입 없음 (근거: <ARCHITECTURE 섹션/키워드>)

- STRUCTURE (배치)
  - [ ] 새 파일/폴더 위치가 규칙에 부합 (근거: <STRUCTURE 섹션/키워드>)
  - [ ] 파일명 `kebab-case` (예약 파일명 예외만) (근거: <STRUCTURE 섹션/키워드>)

- STYLEGUIDE (스타일)
  - [ ] 구현 파일에 `type`/`interface` 선언 없음 (분리 규칙) (근거: <STYLEGUIDE 섹션/키워드>)
  - [ ] 인라인 오브젝트 타입 없음 (근거: <STYLEGUIDE 섹션/키워드>)
  - [ ] 임시 목적의 함수/블록 스코프 상수 선언 금지(재사용 필요 시 명명된 구조/모듈로 승격) (근거: <STYLEGUIDE 섹션/키워드>)
  - [ ] 한 글자 식별자 금지(예외만) (근거: <STYLEGUIDE 섹션/키워드>)

---

## 4) 작업 설계(선택지/결정)

- 선택지 A:
  - 요약: <1~2줄>
  - 장점:
    - <...>
  - 단점/리스크:
    - <...>

- 선택지 B(있다면):
  - 요약: <...>

- 최종 결정:
  - <A/B/기타>
  - 결정 근거(SSOT 기준으로): <...>

---

## 5) 실행 계획(초구체)

> 이 섹션은 **파일 단위**로 작성한다. 각 파일마다 “무엇을/어떻게/왜”를 명시한다.

> 금지:
>
> - 승인(`ㅇㅇ`) 이전 코드 작성
> - TODO / placeholder / 임시 구현
> - 컴파일을 통과하지만 계약을 충족하지 않는 스텁

### Step 1) <짧은 단계명>

- 작업:
  - <구체 작업 1>
  - <구체 작업 2>

- **중간 검증**: 이 단계만 완료한 뒤 안전하게 확인할 방법
  - 예: <타입체크/특정 테스트/특정 파일 단위 검증>

- 변경 파일(각 파일별 상세):
  - <path>
    - 변경 목적: <...>
    - 구현 상세(함수/심볼/행동 단위):
    	- <어떤 심볼을 추가/수정/삭제>
    	- <어떤 입력/출력/에러를 다루는지>
    - 금지/주의:
    	- <경계/결정성/계약 관련>

### Step 2) ...

---

## 6) 검증(Verification) / 완료조건(DoD)

### 필수 게이트

- [ ] `bun run verify` 통과
- [ ] `.agent/workflow.md`의 승인 규칙 준수(사용자 승인 키워드 `ㅇㅇ` 없으면 구현 시작 금지)
- [ ] 범위 밖 변경이 필요해진 경우: 사전 승인(허용 파일/패키지 목록 포함) 없이 진행 금지

### 산출물 무결성

- [ ] 링크/경로 깨짐 없음
- [ ] 문서/템플릿 내 규칙 충돌 없음(SPEC/ARCHITECTURE/STYLEGUIDE 우선)
- [ ] 이번 변경으로 인해 갱신이 필요한 문서 반영 완료(필요 시 승인/절차 준수)

---

## 7) 리스크 / 롤백 / verify 실패 복구

- 주요 리스크:
  - <리스크 1>

- 롤백 전략:
  - <최소 롤백 단위와 되돌리는 방법>

- verify 실패 시:
  - `.agent/workflow.md`의 “verify 실패 복구 프로토콜(최대 5회)”을 따른다.
  - 5회 소진 시 “복구 보고 템플릿” 작성 후 사용자 선택을 기다린다(추가 수정/실행 금지).

---

## Plan Changes (append-only)

> `in-progress`에서만 사용한다.
>
> 규칙:
>
> - 사용자 승인 키워드 `ㅇㅇ` 없이는 추가하지 않는다.
> - 본문(0~7 섹션)을 덮어쓰지 않고, 이 섹션에만 append 한다.

- 변경 요약:
  - <무엇이/왜 바뀌었는지>
- 승인 증거:
  - `ㅇㅇ`
- 영향 범위(Blast Radius):
  - <패키지/디렉터리/공개 API 변경 여부>
