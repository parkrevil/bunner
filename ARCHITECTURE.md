# ARCHITECTURE.md

## 1. Purpose

이 문서는 본 레포지토리의 **구조적 불변식(Architectural Invariants)** 을 정의한다.

ARCHITECTURE는 다음 질문에만 답한다.

- 무엇이 무엇을 **알 수 있는가**
- 어떤 방향의 **의존만 허용되는가**
- 경계를 넘을 때 **허용되는 형태는 무엇인가**

구현 방식, 동작 설명, 정책, 절차는 이 문서의 범위가 아니다.

---

## 2. Top-Level Architectural Units

본 레포지토리는 다음 상위 구조 단위로 분리된다.

- **Core**
  - 런타임의 최소 실행 프리미티브
  - 외부 환경, 통합, 어댑터에 대해 무지하다

- **Common**
  - 경계에서 교환되는 표준 타입/계약 정의
  - 런타임 동작을 소유하지 않는다

- **CLI**
  - 정적 분석, 검증, 코드 생성의 책임을 가진다
  - 런타임 실행 경로에 포함되지 않는다

- **Adapters**
  - 외부 프로토콜을 내부 실행 모델로 번역하는 경계 계층

- **Integrations**
  - 외부 라이브러리/시스템과의 결합을 제공하는 확장 패키지

---

## 3. Dependency Direction (Hard Rules)

다음 의존 규칙은 **절대적 불변식**이다.

1. Core는 Adapter 및 Integration을 의존해서는 안 된다.
2. Common은 Core의 내부 구현에 결합해서는 안 된다.
3. CLI는 런타임 흐름에 개입하지 않는다.
4. Adapter는 Core/Common에만 의존할 수 있다.
5. Integration은 Core/Common의 공개 계약을 통해서만 결합된다.

이 규칙을 우회하는 의존은 허용되지 않는다.

---

## 4. Encapsulation & Facade Rule

각 패키지는 **단일 Public Facade**를 가진다.

- 패키지 외부에서 접근 가능한 API는 **패키지 루트 `index.ts`만**이다.
- 다른 패키지의 `src/**`에 대한 직접 import는 금지된다.
- 경계 우회(import path alias, 상대 경로 트릭)는 허용되지 않는다.

이는 캡슐화가 아니라 **구조 판정 규칙**이다.

---

## 5. Module Boundary

- 모듈의 경계는 **파일 시스템 디렉토리 구조**로 정의된다.
- 명시적 `imports` 등록 메커니즘은 존재하지 않는다.
- 표준 `import` 구문은 곧 의존 선언이며, 정적으로 분석 가능해야 한다.

동적 탐색, 런타임 자동 결합은 아키텍처 위반이다.

---

## 6. Visibility

- 내부 전용 요소(Internal)는 외부 모듈에서 접근할 수 없다.
- 가시성 위반은 런타임이 아닌 **빌드 단계에서 실패**해야 한다.
- 모든 가시성 판정은 **정규화된 파일 경로** 기준으로 수행된다.

---

## 7. Non-Goals

본 아키텍처는 다음을 목표로 하지 않는다.

- 런타임 자동 플러그인 탐색
- 암묵적 전역 등록
- 편의성을 위한 규칙 완화
- 운영/배포/환경 구성 가이드

이러한 영역은 사용자 및 운영 책임이다.

---

## 8. Authority

이 문서는 다음 문서보다 **상위 정본**이다.

- `STRUCTURE.md`
- `docs/specs/*.spec.md`
- `docs/governance/*`

구조적 불변식과 충돌하는 하위 규칙은 무효다.
