# GOVERNANCE

## 역할

- 이 문서는 프로젝트의 의사결정 구조와 변경 승인 기준을 정의한다.

## 목적

- SSOT 및 중요 규칙의 변경이 "조용히" 일어나지 못하게 한다.
- 승인 권한/프로세스를 명확히 해서 책임을 고정한다.

## 적용 범위

- SSOT 문서 변경, 정책 변경, 자동화 개입 범위 조정 등 거버넌스가 필요한 변경

## 정본/우선순위

- 최상위 정본은 [ARCHITECTURE.md](../20_ARCHITECTURE/ARCHITECTURE.md)다.

## 변경 승인 원칙

- 범위 밖 변경은 사전 승인 없이는 불가하다.
- SSOT 문서([SPEC.md](../30_SPEC/SPEC.md)) 변경은 특히 신중해야 하며, 변경 근거/영향/마이그레이션을 포함해야 한다.
- 핵심 집행 SSOT는 규칙을 정의할 때 MUST / MUST NOT / SHOULD / MAY 중 하나를 명시적으로 사용해야 한다.

## 승인이 필요한 변경 유형

| 유형                | 설명                          | 예시                                     |
| ------------------- | ----------------------------- | ---------------------------------------- |
| **범위 확장**       | 사용자 요청 범위 밖 파일 수정 | 다른 패키지 파일 수정 필요               |
| **SSOT 변경**       | 정책/규칙 문서 수정           | docs/specs/spec.md, ARCHITECTURE.md 수정 |
| **Public API 변경** | 패키지 Facade 수정            | `packages/*/index.ts` 변경               |
| **아키텍처 변경**   | 패키지 경계/의존 방향 변경    | 새 패키지 추가, 의존성 방향 수정         |

## 에이전트 승인 요청 프로토콜 (Agent Approval Protocol)

에이전트가 승인이 필요한 상황에서 다음 절차를 따른다.

### 승인 요청 필수 포함 정보

1. **유형**: 범위 확장 / SSOT 변경 / Public API 변경 / 아키텍처 변경
2. **현재 상황**: 왜 승인이 필요한지 1-2줄 요약
3. **요청 범위**: 변경이 필요한 파일/패키지 목록
4. **대안**: 승인 없이 가능한 대안 (있는 경우)
5. **리스크**: 예상되는 영향 범위

### 승인 요청 메시지 예시

```text
## 승인 요청: 범위 확장

**유형**: 범위 확장 (Scope Override)
**현재 상황**: `packages/core/container.ts` 수정 중 `packages/common/interfaces.ts`의 타입 변경이 필요함
**요청 범위**:
- `packages/common/src/interfaces.ts`: `ContainerOptions` 타입에 `lazyInit` 속성 추가
**대안**: 없음 (타입 불일치로 빌드 실패)
**리스크**: `@bunner/http-adapter`, `@bunner/scalar`에서 해당 타입 사용 시 영향 가능

승인하시겠습니까?
```

### 승인 응답 해석 기준

| 응답 유형       | 사용자 응답 예시                           | 에이전트 행동             |
| --------------- | ------------------------------------------ | ------------------------- |
| **명시적 승인** | "Y", "승인", "진행해", "OK", "ㅇㅇ"        | 요청된 범위 내에서 진행   |
| **조건부 승인** | "파일 X만 수정해", "테스트 추가 후 진행해" | 조건 만족 후 진행         |
| **거부**        | "N", "중단", "다른 방법 찾아봐"            | 현재 접근 중단, 대안 모색 |
| **불명확**      | 위 어느 것에도 해당하지 않음               | 재확인 요청               |

### 승인 없이는 불가한 행동

- SSOT 문서 직접 수정
- 다른 패키지의 Public Facade 변경
- 사용자가 명시하지 않은 패키지 수정
- 아키텍처 의존 방향 변경

## 자동화 개입 허용 한계

- 자동화는 SSOT를 임의로 약화시키지 않는다.
- 자동화는 실패를 숨기지 않고, 실패 원인을 명확히 보고한다.

## 엣지 케이스 처리

| 상황                  | 행동                                                    |
| --------------------- | ------------------------------------------------------- |
| 규칙 간 충돌          | ARCHITECTURE.md 우선, 여전히 모호하면 중단 후 확인 요청 |
| 승인자 응답 없음      | 작업 중단, 대기                                         |
| 긴급 상황 (빌드 깨짐) | 최소 수정 후 즉시 승인 요청                             |
| 승인 거부됨           | 대안 탐색 → 없으면 작업 종료                            |
| 해석 모호함           | 중단 후 선택지 제시                                     |

## 실행 체크리스트

- [ ] SSOT/정책 문서를 바꾸려는 변경인가? → 승인 요청으로 전환
- [ ] 범위 밖 변경이 필요한가? → 승인 요청으로 전환
- [ ] Public API/Facade 변경인가? → export 목록 제시 후 승인 요청
- [ ] 승인 응답이 명확한가? → 불명확하면 재확인
- [ ] 승인 없이 규칙을 완화하는 변경인가? → 즉시 중단
