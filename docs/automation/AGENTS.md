# AGENTS.md

## 1. 문서의 역할

이 문서는 본 프로젝트에서 **AI 에이전트가 코드 및 문서를 생성·수정·삭제할 때 반드시 준수해야 하는 집행 규칙**을 정의한다.

본 문서는 **에이전트 행동 제어를 위한 운영 규약**이며, 설명 문서가 아니다.

## 2. 정본(SSOT)

- 프로젝트의 최상위 정본(Single Source of Truth)은 [SPEC.md](SPEC.md)다.
- 본 문서의 모든 규칙은 [SPEC.md](SPEC.md)를 보조·집행하기 위한 것이다.
- 충돌 시 항상 `SPEC.md`의 규칙이 우선한다.

## 3. 적용 대상

이 문서는 다음 모든 행위에 적용된다.

- 코드 생성, 수정, 삭제
- 문서 생성, 수정, 삭제
- 테스트 코드 및 스크립트 변경
- 자동화 스크립트 실행 또는 수정
- 리팩토링, 구조 변경, 네이밍 변경

## 4. 집행 원칙 (Enforcement Principles)

### 4.1 범위 제한 원칙 (Scope Restriction)

- 에이전트는 **사용자가 명시적으로 지시한 범위 내에서만** 작업해야 한다(MUST).
- 범위를 벗어나는 변경은 금지된다(MUST NOT).
- “범위 밖 변경”은 사용자가 이번 작업에서 명시적으로 요청한 대상/패키지/기능/목표 밖의 수정·추가·삭제를 의미한다.
- 범위 확장이 필요하다고 판단될 경우, **반드시 사전 승인**을 요청해야 한다(MUST).

#### 4.1.1 예외 프로토콜: 명시적 승인 기반 범위 확장 (Scope Override Protocol)

아래 조건을 **모두** 만족하는 경우에 한해, 에이전트는 “범위 밖 변경”을 **최소 단위로** 수행할 수 있다.
이 예외는 “편의상”이 아니라 “필수 오류 해결”을 위한 통제된 탈출구이며, 범위 제한 원칙을 일반적으로 약화시키지 않는다.

필수 조건(전부 MUST):

- 사용자의 범위 내 변경(예: 메인 스코프/핵심 파일 수정)으로 인해, 범위 밖 파일에서 **verify 실패가 발생**했음이 확인되어야 한다.
- 범위 내에서만 수정하여 실패를 해결할 수 없다는 근거를 제시해야 한다.
  - 예: 실패 스택/에러 메시지가 범위 밖 파일을 직접 지목하거나, 범위 내 수정으로는 해결 불가능한 계약/시그니처 불일치가 존재함.
- 사용자가 이번 세션에서 “범위 밖 수정”을 **명시적으로 승인**해야 한다.
  - 승인에는 최소한 “수정이 허용되는 파일/패키지 목록”과 “해결하려는 실패 종류(verify 등)”가 포함되어야 한다.
- 변경은 오직 실패를 해결하는 데 필요한 **최소 변경**이어야 한다.
  - 포맷팅-only, 리네임, 리팩토링, 정리는 금지된다.
- Public Facade/Contract는 사용자의 추가 명시가 없는 한 변경해서는 안 된다(MUST NOT).
- 예외 변경 후에는 관련 게이트(해당 스코프의 `verify`)를 재실행해 통과를 확인해야 한다.

보고 의무(MUST):

- 어떤 실패를 해결하기 위해 어떤 범위 밖 파일을 수정했는지, 그리고 왜 범위 내 수정으로는 불가했는지 요약해 남긴다.

### 4.2 가정 금지 원칙 (No Assumptions)

- 에이전트는 다음 행위를 해서는 안 된다.
  - 추측에 기반한 구현
  - “일반적으로 이렇게 한다”는 관행 적용
  - 기존 코드가 정상일 것이라는 전제
- 명시되지 않은 사항은 **항상 불확실한 상태**로 간주한다.

추가 강제(Enforced):

- “확장을 고려해서”, “나중에 필요할 것 같아서” 같은 상상을 근거로 변경을 수행해서는 안 된다(MUST NOT).
- 작업은 반드시 현재 사용자 요구사항에만 충실해야 한다(MUST).

### 4.3 판단 금지 원칙 (No Discretion)

- 에이전트는 아키텍처, 구조, 규칙에 대해 **자율적 판단 권한을 갖지 않는다**.
- “더 깔끔함”, “효율적임”, “유지보수에 좋아 보임” 등의 주관적 개선은 금지된다.
- 규칙에 정의된 방식이 비효율적이더라도 **반드시 그대로 따른다**.

### 4.4 언어 사용 규칙 (Korean Only)

- 에이전트는 사용자와의 모든 커뮤니케이션을 한국어로 작성해야 한다(MUST).
- 에이전트가 생성·수정·추가하는 문서의 자연어 텍스트는 한국어로 작성해야 한다(MUST).

예외(강제, MUST):

- 상위/동급 SSOT 문서가 특정 언어를 강제하는 산출물은 해당 규칙을 우선한다.
  - 예: [COMMITS.md](COMMITS.md)의 “커밋 메시지는 영어로만 작성” 규칙
- 코드 식별자(심볼/파일명/패키지명 등)는 프로젝트 네이밍 규칙(SSOT: [STYLEGUIDE.md](STYLEGUIDE.md))을 따른다.
- 외부 표준(프로토콜/포맷/명세 등)과의 호환을 위해 영어가 필수인 경우, 그 호환 요구사항을 우선한다.

### 4.5 즉시 중단 조건 요약표 (Quick Stop Reference)

아래 조건 중 하나라도 해당하면 **즉시 중단**한다. 상세 기준은 각 SSOT 문서를 참조.

| 카테고리       | 조건                                                         | 상세 SSOT     |
| -------------- | ------------------------------------------------------------ | ------------- |
| **보안**       | 민감정보(키/토큰/비밀번호) 저장소 반입                       | POLICY.md     |
| **보안**       | 라이선스/저작권 위반 가능성 있는 코드 포함                   | POLICY.md     |
| **AOT**        | `reflect-metadata` 사용 또는 런타임 리플렉션 도입            | POLICY.md     |
| **AOT**        | 비결정적 산출물(시간/랜덤 의존) 도입                         | POLICY.md     |
| **경계**       | cross-package deep import (다른 패키지 `src/**` 직접 import) | POLICY.md     |
| **경계**       | 순환 의존성(Circular Dependency) 도입                        | POLICY.md     |
| **계약**       | Public Facade 무단 변경                                      | POLICY.md     |
| **계약**       | Silent breaking change (타입 유지, 의미 변경)                | POLICY.md     |
| **폭주**       | 동일 구간 3회 이상 수정-되돌림 반복 (thrashing)              | SAFEGUARDS.md |
| **폭주**       | 범위 밖 변경 필요 시 승인 없이 진행                          | SAFEGUARDS.md |
| **워크플로우** | accepted 상태의 Plan/Spec 없이 새 기능 구현 시도             | 15장          |
| **워크플로우** | Spec/ADR이 accepted 아닌 상태에서 구현 시도                  | 15장          |
| **워크플로우** | 아키텍처 영향이 있는 변경 시 ARCHITECTURE.md 미참조          | 15장          |

### 4.6 범위 밖 변경 예시 (Scope Examples)

**시나리오**: 사용자가 `packages/core/src/container.ts` 수정을 요청함

| 구분       | 예시                                                   | 판정      |
| ---------- | ------------------------------------------------------ | --------- |
| ✅ 범위 내 | `container.ts` 및 해당 파일의 유닛 테스트 수정         | 허용      |
| ✅ 범위 내 | 동일 패키지 내부의 import 대상 파일 타입 호환 수정     | 허용      |
| ❌ 범위 밖 | `packages/http-adapter/src/**` 수정                    | 승인 필요 |
| ❌ 범위 밖 | `packages/common/src/interfaces.ts`의 public 타입 변경 | 승인 필요 |
| ❌ 범위 밖 | 다른 패키지의 테스트 파일 수정                         | 승인 필요 |

**범위 밖 수정이 필요한 경우**: 즉시 중단하고 사용자에게 승인 요청 (4.1.1 Scope Override Protocol 참조)

## 5. 실행 전 검증 규칙 (Verify Before Execute)

에이전트는 어떤 변경을 수행하기 전에 반드시 다음을 확인해야 한다.

1. 작업이 [SPEC.md](SPEC.md), [ARCHITECTURE.md](ARCHITECTURE.md), [STYLEGUIDE.md](STYLEGUIDE.md) 중 어떤 규칙에 해당하는지 확인
2. 파일 배치, 네이밍, export 정책, 테스트 방식 확인
3. 변경 대상이 모듈 경계를 침범하지 않는지 물리적으로 확인

또한 변경 성격에 따라 추가 문서 확인이 필요할 수 있다.

프로젝트에 해당 문서가 **존재하는 경우 반드시 확인한다**.

검증되지 않은 변경은 수행해서는 안 된다.

### 5.1 변경 영향 범위 선언 (Blast Radius Control)

변경을 실행하기 전에, 에이전트는 반드시 아래 항목을 **명시적으로 식별**해야 한다.

- 영향을 받을 수 있는 모듈/패키지
- 영향을 받을 수 있는 public API 또는 계약(Contract)

변경 영향 범위를 확신할 수 없다면, 에이전트는 즉시 중단하고 사용자에게 확인을 요청해야 한다.

### 5.2 테스트 무결성 (Tests as a Gate)

- 변경이 로직/행동/계약(Contract)에 영향을 준다면, 관련 테스트는 반드시 존재하거나 업데이트되어야 한다.
- 필요한 테스트가 누락되어 있고 테스트 추가가 작업 범위를 벗어난다면, 에이전트는 즉시 중단하고 사용자에게 지침을 요청해야 한다.
- 에이전트는 실패하는 테스트를 조용히 우회하거나 삭제해서는 안 된다.

### 5.3 PR 게이트 (CONTRIBUTING Gate)

> **핵심**: tsc 통과 + lint 통과 + test 통과

- 에이전트가 생성한 PR/변경은 [CONTRIBUTING.md](CONTRIBUTING.md)의 PR 기준을 통과해야 한다.
- [CONTRIBUTING.md](CONTRIBUTING.md)는 에이전트 행동 규칙의 SSOT가 아니라, 결과물의 merge 가능 여부를 판정하는 게이트다.

### 5.4 데드 코드 제거 게이트 (Dead Code Policy Gate)

> **핵심**: 제거 전 Dead/Valueless 분류 + 증명 기록 필수

- 에이전트는 데드 코드/파일 제거 작업 시 [DEAD_CODE_POLICY.md](DEAD_CODE_POLICY.md)의 판정 기준과 절차를 준수해야 한다.

### 5.5 승인/중단 게이트 (GOVERNANCE Gate)

> **핵심**: SSOT/정책 변경 시 사전 승인 필수

- 에이전트가 SSOT 문서 변경, 정책 변경, 자동화 개입 범위 조정을 수행하려면 [GOVERNANCE.md](GOVERNANCE.md)의 승인/중단 기준을 따라야 한다.

### 5.5.1 핵심 SSOT 변경 시 비전 참조 규칙 (Vision Reference Gate)

> **핵심**: SPEC/ARCHITECTURE/INVARIANTS 변경 시 VISION.md 참조 필수

에이전트가 다음 문서를 생성·수정할 때는 [VISION.md](VISION.md)를 먼저 읽어야 한다(MUST):

- SPEC.md
- ARCHITECTURE.md
- INVARIANTS.md

필수 검증(MUST):

1. 변경 내용이 VISION.md의 핵심 원칙에 부합하는지 확인한다.
2. 부합하지 않거나 판단이 불확실하면 즉시 중단하고 사용자에게 확인을 요청한다.
3. 부합 근거를 변경 시 함께 제시한다.

VISION.md의 핵심 원칙:

- Predictability as a Requirement (예측 가능성)
- Structure Over Rules (규칙보다 구조)
- Separation of Enduring Concerns (관심사 분리)
- Failure Must Remain Understandable (실패 이해 가능성)
- Automation Without Opacity (투명한 자동화)
- On Ease and Clarity (명확함 우선)

### 5.6 즉시 중단 게이트 (POLICY Gate)

> **핵심**: 보안/AOT/경계/계약 위반 시 즉시 중단 (4.5 요약표 참조)

- 위반 시 즉시 중단해야 하는 항목은 [POLICY.md](POLICY.md)를 따른다.

### 5.7 용어(개념) SSOT 준수 (Terminology Gate)

- 패키지 관계(`dependencies`/`peerDependencies`/`devDependencies`), 모듈 경계, 역할/책임을 판정할 때 사용하는 용어(예: adapter, plugin, middleware, error filter/handler)는 [ARCHITECTURE.md](ARCHITECTURE.md)의 정의를 SSOT로 따른다.
- 용어의 의미가 불명확하거나, 기존 정의로는 결정을 내릴 수 없다면 임의로 정의를 확장하지 말고 즉시 중단한 뒤 사용자에게 확인을 요청한다.
- 새 개념을 도입하거나 기존 용어의 의미를 변경해야 한다면, 이는 아키텍처 변경으로 취급하며 문서(ARCHITECTURE) 업데이트가 선행되어야 한다.

### 5.8 파일/디렉토리 생성 게이트 (Creation Gate)

에이전트가 파일/디렉토리를 생성·이동·분리·병합하려면, 실행 전에 아래를 반드시 만족해야 한다.

1. 위치(Placement) 판정

- SSOT: [STRUCTURE.md](STRUCTURE.md)
- 신규 파일/디렉토리가 `src/<feature>/`에 속하는지, `src/common/`에 속하는지, 또는 패키지 경계 변경인지 먼저 판정한다.
- 다른 패키지의 `src/**`를 직접 import 하도록 만드는 변경은 즉시 중단한다.

1. 네이밍(Naming) 판정

- SSOT: [STYLEGUIDE.md](STYLEGUIDE.md) “6. 네이밍 규칙”
- `index.ts`, `types.ts` 등 예약 파일명(Reserved Filenames)인지 먼저 확인하고, 예약 파일명이 아니라면 `kebab-case`를 강제한다.

1. Blast Radius 선언

- 생성/이동/분해가 영향을 주는 패키지, public facade(`index.ts`) 변경 여부를 식별한다.
- 영향 범위를 확신할 수 없으면 즉시 중단하고 사용자에게 확인을 요청한다.

### 5.9 커밋 게이트 (COMMITS Gate)

> **핵심**: Conventional Commits 형식 (`type(scope): subject`) + 영어 + 본문 필수

- 에이전트가 생성하는 커밋은 [COMMITS.md](COMMITS.md)의 규칙을 따라야 한다.

### 5.10 툴링/CLI 게이트 (TOOLING Gate)

> **핵심**: CLI는 런타임 패키지에 의존 금지, verify는 루트에서만 실행

- CLI 관련 변경 시 [TOOLING.md](TOOLING.md)의 정책을 따라야 한다.

## 6. 모듈 경계 및 import 규칙

- `../` 경로가 2단계 이상 필요한 import는 모듈 경계 침범 가능성이 있으므로 즉시 중단한다.
- 단, 파일 시스템 기준으로 “동일 패키지 내부(importer가 속한 `packages/<name>/` 경로 내부)”임을 물리적으로 확인할 수 있는 경우에 한해 작업을 계속할 수 있다.
- 다음 항목을 명시적으로 확인해야 한다.
  - 모듈 경계를 침범하는지 여부
  - 해당 디렉토리에 `index.ts`(또는 Facade)가 존재하는지
- 검증 없이 작성된 import는 금지된다.

### 6.1 Public API / Contract 보호 (Public API Protection)

- 에이전트는 사용자가 명시적으로 지시하지 않은 한, public API, export된 계약(Contract), 문서화된 인터페이스를 변경해서는 안 된다.
- 어떤 심볼이 public인지 불명확하다면, 기본적으로 public으로 취급해야 한다.

추가 강제(Enforced):

- 이 레포에서 패키지의 public API는 패키지 루트 `index.ts`(Public Facade)로만 정의한다(MUST).
- 에이전트가 패키지 루트 `index.ts`를 수정해야 한다면, 먼저 해당 파일의 export 대상 목록을 나열하고,
  사용자가 노출 대상(유지/추가/삭제)을 선택하도록 요청해야 한다(MUST).
- 사용자의 선택/승인 없이 `index.ts`를 수정해서는 안 된다(MUST NOT).

## 7. 전수 검증 프로토콜 (Comprehensive Verification)

사용자가 다음과 같은 요청을 할 경우 즉시 발동된다.

- “전부 확인”
- “전체 코드베이스 조사”
- “누락 없이 검증”

### 7.1 기본 원칙

- 모든 기존 파일은 **검증되지 않은 상태**로 간주한다.
- 부분 확인, 표본 검사, 추정은 허용되지 않는다.

### 7.2 필수 절차

1. 대상 범위의 모든 파일을 시스템 명령으로 목록화
2. 목록에 포함된 파일을 하나도 빠짐없이 검사
3. 각 파일의 상태를 논리적으로 재검증

단 하나의 파일이라도 누락되면 검증은 실패로 간주한다.

## 8. 묵시적 결정 금지

- 사용자가 명시하지 않은 다음 요소를 임의로 결정하지 않는다.
  - 파일 위치
  - 네이밍
  - 패턴 선택
  - 구조 분해 방식
- 모호한 경우 작업을 중단하고 선택지를 제시한다.

## 9. 집행 상태

- 본 문서의 규칙은 **상시 적용**된다.
- 본 문서에 정의되지 않은 예외는 인정되지 않는다.
- 규칙을 우회하려면 반드시 사용자로부터 명시적 승인을 받아야 한다.

### 9.1 부분 완료/플레이스홀더 금지 (No Partial or Placeholder Work)

- 에이전트는 사용자가 명시적으로 지시하지 않은 한, 부분 구현, TODO, 플레이스홀더 코드를 남겨서는 안 된다.
- 불완전한 작업 결과를 "최종 결과"로 제출해서는 안 된다.

### 9.2 실패 시 행동 가이드 (Failure Handling)

에이전트가 규칙을 따를 수 없거나 예상치 못한 상황에 처했을 때의 행동 지침.

| 실패 유형           | 즉시 행동      | 후속 행동                             |
| ------------------- | -------------- | ------------------------------------- |
| 규칙을 따를 수 없음 | 즉시 중단      | 상황 설명 + 대안 제시                 |
| verify 실패         | 원인 분석      | 범위 내 수정 시도 → 불가 시 승인 요청 |
| 승인 거부됨         | 현재 접근 포기 | 대안 탐색 후 재제안 or 작업 종료      |
| 해석 모호함         | 즉시 중단      | 가능한 해석 나열 + 결정 요청          |
| 예상치 못한 에러    | 즉시 중단      | 에러 내용 상세 보고                   |
| 충돌 해결 불가      | 작업 종료      | 충돌 내용 + 시도한 방법 보고          |

**기본 원칙**: 불확실하면 **추측하지 말고 중단** 후 확인 요청

## 10. 실행 체크리스트 (요약)

- [ ] 작업 범위가 명확한가
- [ ] 범위 확장이 필요하면 사전 승인을 요청했는가
- [ ] 변경 영향 범위(Blast Radius)를 명시했는가
- [ ] Public API/Contract 변경 여부를 확인했는가
- [ ] 적용 규칙을 확인했는가
- [ ] 모듈 경계를 검증했는가
- [ ] 근거가 되는 문서/규칙을 명시했는가
- [ ] 관련 문서가 존재하는 경우 확인했는가
- [ ] 테스트 무결성(게이트) 요구사항을 충족했는가
- [ ] 추측이나 임의 판단이 개입되지 않았는가

## 11. Feature 워크플로우 (Feature Workflow)

사용자가 작업을 요청할 때, 에이전트는 아래 워크플로우를 따른다.

상세 워크플로우: [workflows/feature-workflow.md](workflows/feature-workflow.md)

### 11.1 워크플로우 개요

```text
사용자 요청
  ↓
[exploration] → Plan 자동 생성 → 피드백 루프
  ↓
[draft] → 논의 발생 시 → [negotiation] → ADR 생성
  ↓
[proposed] → 사용자 승인
  ↓
[accepted] → Spec 확정 → 하드 스탑 통과
  ↓
구현 시작
  ↓
[implemented] → DoD 충족
```

### 11.2 상태별 허용 행동

| 상태        | 허용 행동                       | 금지 행동      |
| ----------- | ------------------------------- | -------------- |
| exploration | 질문, 범위 탐색, Plan 초안 생성 | 구현 코드 작성 |
| draft       | Plan 수정, 피드백 반영          | 구현 코드 작성 |
| negotiation | ADR 작성, 대안 비교             | 구현 코드 작성 |
| proposed    | Spec 작성, 사용자 승인 대기     | 구현 코드 작성 |
| accepted    | 구현 코드 작성                  | Spec/계약 변경 |
| implemented | 검증, 문서 업데이트             | 추가 변경      |

## 12. Feature 상태 머신 (Feature State Machine)

모든 작업은 다음 6개 상태 중 하나에 있다.

### 12.1 상태 정의

```text
exploration   → 요구사항 탐색 중
negotiation   → 설계 논의 중 (2개 이상 대안 존재)
draft         → Plan 초안 작성됨
proposed      → 설계 제안됨, 승인 대기
accepted      → 설계 확정, 구현 가능
implemented   → 구현 완료
```

### 12.2 상태 저장 위치

상태는 문서의 frontmatter `status:` 필드에 기록한다(MUST).

```yaml
---
status: draft
created: 2025-01-01
updated: 2025-01-02
feature: <name>
---
```

에이전트는 작업 전 다음을 확인해야 한다(MUST):

1. `docs/plans/<name>.md` 존재 여부 확인
2. 존재하면 `status:` 필드 확인
3. 상태에 따른 허용 행동 확인 (11.2 참조)

## 13. 상태 전이 규칙 (State Transition Rules)

상태 전이는 아래 조건을 충족해야만 가능하다(MUST).

### 13.1 exploration → draft

**트리거**: 사용자가 작업 요청

**전이 조건**:

- [ ] `docs/plans/<name>.md` 파일 생성됨
- [ ] 목표(Goal) 섹션이 채워짐

**액션**: Plan 초안 자동 생성 (14장 참조)

### 13.2 draft → negotiation

**트리거**: 다음 중 하나 발생

- 사용자가 제안된 설계에 불만 표현
- 가능한 설계안이 2개 이상 존재
- 아키텍처/스펙 변경 필요

**전이 조건**:

- [ ] 2개 이상의 대안이 식별됨

**액션**: ADR 문서 자동 생성

### 13.3 negotiation → proposed

**트리거**: 사용자가 하나의 설계안을 명시적으로 선택

**전이 조건**:

- [ ] ADR 문서에 Decision 항목이 채워짐
- [ ] 사용자가 선택을 명시적으로 확인함

**액션**: ADR 상태를 Proposed로 변경

### 13.4 proposed → accepted

**트리거**: 설계가 확정됨

**전이 조건**:

- [ ] Spec 문서가 존재하며 status: proposed 이상
- [ ] 아키텍처 영향 여부가 식별됨
- [ ] 사용자가 설계를 명시적으로 승인함 ("좋아/진행해/승인")

**액션**: 구현 단계 진입 허용

### 13.5 accepted → implemented

**트리거**: 구현 완료

**전이 조건**:

- [ ] 16장 완료 기준(DoD) 모두 충족
- [ ] `bun run verify` 통과

**액션**: 작업 완료 처리

## 14. 자동 문서 생성 규칙 (Auto-Generation Rules)

에이전트는 다음 조건에서 문서를 자동 생성해야 한다(MUST).

### 14.1 Plan 자동 생성

**조건**: 작업 요청 시 `docs/plans/<name>.md` 없음

**액션**:

1. `templates/plan.md` 템플릿 기반으로 Draft 초안 생성
2. 생성 후 **반드시** 사용자에게 검토 요청 (notify_user)
3. 사용자 피드백 반영 후 상태 전이

### 14.2 Spec 자동 생성

**조건**: 구현에 계약/인터페이스 정의가 필요하나 `docs/specs/<name>.md` 없음

**액션**:

1. `templates/spec.md` 템플릿 기반으로 Draft 초안 생성
2. 생성 후 **반드시** 사용자에게 검토 요청 (notify_user)
3. 사용자 피드백 반영 후 상태 전이

### 14.3 ADR 자동 생성

**조건**: 설계 논쟁 발생 (2개 이상 대안 제시됨)

**액션**:

1. `templates/adr.md` 템플릿 기반으로 Draft 초안 생성
2. 대안들을 Options 섹션에 정리
3. 생성 후 **반드시** 사용자에게 검토 요청 (notify_user)

### 14.4 자동 생성 원칙

- 모든 자동 생성 문서는 `status: draft`로 시작한다(MUST)
- 자동 생성 후 사용자 피드백 없이 상태를 변경해서는 안 된다(MUST NOT)
- Draft 문서 생성 자체에는 사용자 승인이 필요하지 않다

## 15. 하드 스탑 게이트 (Hard Stop Gate)

다음 조건 중 하나라도 해당하면 에이전트는 구현 코드를 작성해서는 안 된다(MUST NOT).

### 15.1 구현 진입 차단 조건

| 조건                        | 필요 문서                     | 필요 상태 |
| --------------------------- | ----------------------------- | --------- |
| 작업이 accepted 상태가 아님 | `docs/plans/<name>.md`        | accepted  |
| 계약/인터페이스 정의 필요   | `docs/specs/<name>.md`        | accepted  |
| 아키텍처 영향이 있음        | ARCHITECTURE.md 업데이트 선행 | -         |
| 설계 논쟁이 있었음          | ADR 문서                      | accepted  |

### 15.2 위반 시 행동

하드 스탑 조건 위반 시 에이전트는:

1. 즉시 구현 중단
2. 누락된 문서를 Draft로 자동 생성 (14장 참조)
3. 사용자에게 검토 요청
4. 문서가 accepted 상태가 될 때까지 구현 재개 금지

### 15.3 예외

다음 경우에만 하드 스탑을 우회할 수 있다:

- 사용자가 **명시적으로** "문서 없이 진행해"라고 지시한 경우
- 단, 이 경우에도 에이전트는 위험을 고지해야 한다(MUST)

## 16. 완료 기준 (Definition of Done)

작업이 implemented 상태로 전이하려면 다음을 모두 충족해야 한다(MUST).

### 16.1 문서 완료 조건

| 조건                                  | 필수 |
| ------------------------------------- | ---- |
| Plan 문서가 accepted 상태             | MUST |
| Spec 필요 시 accepted 상태            | MUST |
| 아키텍처 영향 시 ARCHITECTURE.md 반영 | MUST |
| ADR 필요 시 accepted 상태             | MUST |

### 16.2 코드 완료 조건

| 조건                                      | 필수 |
| ----------------------------------------- | ---- |
| `bun run verify` 통과 (tsc + lint + test) | MUST |
| 변경 사항에 대한 테스트 존재              | MUST |
| Public Facade 변경 시 승인 득함           | MUST |

### 16.3 검증 체크리스트

에이전트는 implemented 선언 전 다음을 확인해야 한다(MUST):

- [ ] 관련 Plan/Spec 문서가 accepted 상태인가?
- [ ] ADR이 필요했다면 accepted 상태인가?
- [ ] ARCHITECTURE.md 변경이 필요했다면 반영되었는가?
- [ ] `bun run verify` 통과하는가?
- [ ] 변경 사항에 테스트가 있는가?

### 예외: 단순 작업

다음 조건을 **모두** 만족하는 경우, 11~16장 워크플로우를 생략하고 바로 실행할 수 있다:

- 사용자 요청이 명확하고 구체적임
- 영향 범위가 단일 파일 또는 명백히 한정됨
- 아키텍처 영향이 없음
- 버그 수정/리팩토링

예: "이 함수 이름 바꿔줘", "이 버그 고쳐줘", "이 테스트 추가해줘"

## 부록 A. 책임 범위 한계

본 문서는 AI 에이전트의 행동을 통제하기 위한 규칙만을 다룬다.

프로젝트의 법적, 운영적, 조직적 의사결정은 본 문서의 범위를 벗어난다.
