---
description: Test conventions (TDD, BDD, bun:test)
globs: "**/test/**,**/*.test.ts,**/*.spec.ts"
alwaysApply: false
---

# Test Standards

## Priority

Integration tests > Unit tests.
- Write integration tests first.
- Unit tests only when integration tests cannot cover the case.

## TDD Loop

1. User instruction → **Write ALL tests first** → Confirm RED (all new tests fail)
2. After RED confirmed → Implement → Confirm GREEN (all tests pass)
3. Mixing implementation code during the test-writing phase is prohibited.
4. Only minimal types/interfaces required for test compilation are allowed before RED.

## Style

- **BDD naming**: `describe` / `it` (describe behavior)
- **AAA structure**: Arrange → Act → Assert

## Mocking

- Mock anything **outside the test boundary (SUT)**.
- Internal or external is irrelevant — if it crosses the SUT boundary, mock it.

## Runner

`bun:test`

## File Locations

| Type | Location | Extension |
|------|----------|-----------|
| Unit | Next to source file (colocation) | `*.spec.ts` |
| Integration | `packages/*/test/` | `*.test.ts` |

## Test Utilities

`test/stubs/`, `test/fixtures/`, `test/helpers/`
