# SAFEGUARDS

## 역할

- 이 문서는 폭주 방지, 대량 수정 제한, 실패/중단/롤백 기준을 정의한다.

## 목적

- 에이전트/자동화가 안전장치를 우회하는 것을 방지한다.
- 실패 시 “어디까지가 허용 가능한가”를 명시해 즉시 중단/롤백을 가능하게 한다.

## 적용 범위

- 문서/코드 변경을 수반하는 모든 자동화 및 에이전트 작업

## 정본/우선순위

- 최상위 정본은 [SPEC.md](SPEC.md)다.

## 관련 문서

- 위반 시 즉시 중단(보안/법적/핵심 불변조건): [POLICY.md](POLICY.md)
- 승인/승격(거버넌스): [GOVERNANCE.md](GOVERNANCE.md)
- 에이전트 집행 규칙: [AGENTS.md](AGENTS.md)

## 중단 기준 (즉시 Stop)

- 사용자가 요구한 범위를 벗어나는 변경이 필요한 상황
  - 단, [AGENTS.md](AGENTS.md)의 “예외 프로토콜: 명시적 승인 기반 범위 확장” 조건을 **모두** 만족하고,
    사용자가 범위 밖 수정(파일/패키지 목록 포함)을 **명시적으로 승인**한 경우는 예외로 한다.
- AOT 결정성 위반 또는 런타임 스캔/반사 도입 필요 상황
- 순환 의존성 도입이 발견된 상황
- 동일한 파일/구간을 반복 수정/되돌리는 thrashing 상태가 발생한 상황
- `STYLEGUIDE.md`의 “클래스 선택 기준(11.2)” 체크리스트를 만족하지 못하는 클래스를
  신규 도입/유지해야 하는 상황
- `STYLEGUIDE.md`의 “단일-심볼 파일(16.6)” 정당화 조건을 만족하지 못하는 신규 파일을
  추가해야 하는 상황
- `STRUCTURE.md`의 `src/common/` 배치 강제 규칙을 만족하지 못하는 배치를
  추가/유지해야 하는 상황
- `DEAD_CODE_POLICY.md`의 증명 기록 포맷을 충족하지 못한 상태로 데드 코드/파일 제거를
  진행해야 하는 상황
- 동일 파일의 동일 구간에 대해, 실패/되돌림을 수반하는 수정이 3회 이상 반복되는 상황

## 대량 변경 제한

- 한 번에 너무 많은 파일을 변경해야 한다면 먼저 계획/승인을 받는다(승인 기준: [GOVERNANCE.md](GOVERNANCE.md)).
- 포맷팅-only 대량 변경은 요청 없이는 금지한다.

## 롤백 기준

- 변경 후 `verify`가 깨지고 원인이 작업 범위 내에서 즉시 해결 불가하면 롤백한다.
- API/공개 Facade 계약을 깨뜨리는 변경이 발생하면 롤백한다.

## 되돌리기 인식 (Reversibility Awareness)

- 대량 변경 또는 구조적 변경을 수행할 때, 변경이 되돌릴 수 있는지(rollback/revert 가능성)를 고려하는 것을 권장한다.
- 안전한 롤백 전략이 불명확하다면, 진행 전에 사용자에게 경고하고 확인을 요청하는 것을 권장한다.

## 실행 체크리스트 (가이드)

- “범위 밖 변경”이 조금이라도 필요해지면 즉시 중단하고 승인 요청으로 전환한다.
- 순환 의존/결정성 위반 가능성이 보이면 즉시 중단하고 원인 분석으로 전환한다.
